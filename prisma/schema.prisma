// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public", "conversions", "users"]
}

enum CardType {
  ENERGY
  TRAINER
  POKEMON

  @@schema("public")
}

model Card {
  id           String   @id
  printedId    String   @map("printed_id")
  name         Json     @db.JsonB
  setCode      String   @map("set_code")
  rarity       String
  type         CardType
  legal        Json     @db.JsonB
  cardNumber   Int?     @map("card_number")
  imageUrl     String?  @map("image_url")
  updatedAt    DateTime @default(now()) @map("updated_at")
  apiUpdatedAt DateTime @map("api_updated_at")
  trainer      Json?    @db.JsonB
  energy       Json?    @db.JsonB
  pokemon      Json?    @db.JsonB

  @@map("cards")
  @@schema("public")
}

model CardSet {
  id           String   @id
  name         String
  series       String
  legal        Json     @db.JsonB
  abbreviation String?
  releaseDate  DateTime @map("release_date")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("card_set")
  @@schema("public")
}

model EnergyTypeMap {
  energyType String @id @map("energy_type")
  fullText   String @map("full_text")

  @@map("energy_type_map_en")
  @@schema("conversions")
}

model EnergyAbbreviationMap {
  ptcglExport String @id @map("ptcgl_export")
  fullText    String @map("full_text")

  @@map("energy_abbrv_map")
  @@schema("conversions")
}

model EnergyAliasMap {
  alias     String @id
  canonical String @map("canonical")

  @@map("energy_alias_map")
  @@schema("conversions")
}

model SetCodes {
  intlCode     String  @id @map("intl_code")
  japaneseCode String  @map("japanese_code")
  intlName     String  @map("intl_name")
  japaneseName String? @map("japanese_name")

  @@map("set_codes_en")
  @@schema("conversions")
}

model MetaState {
  id        String   @id
  value     Json     @db.JsonB
  updatedAt DateTime @default(now()) @map("updated_at")
  info      Json?    @db.JsonB

  @@map("meta_state")
  @@schema("public")
}

model User {
  id           String         @id
  email        String         @unique
  name         String?
  createdAt    DateTime       @default(now()) @map("created_at")
  updatedAt    DateTime       @updatedAt @map("updated_at")
  UserDeck     UserDeck[]
  Participants Participants[]

  @@map("users")
  @@schema("users")
}

model UserDeck {
  id           String         @id
  userId       String         @map("user_id")
  name         String?
  deckList     String?        @map("deck_list")
  createdAt    DateTime       @default(now()) @map("created_at")
  updatedAt    DateTime       @updatedAt @map("updated_at")
  user         User           @relation(fields: [userId], references: [id])
  Participants Participants[]

  @@map("user_decks")
  @@schema("users")
}

model Event {
  id           String         @id
  name         String?
  type         String
  description  String?        @map("description")
  organizer    String?        @map("organizer")
  dateIssued   DateTime       @map("date_issued")
  dateHeld     DateTime       @map("date_held")
  properties   Json?          @db.JsonB
  location     String?        @map("location")
  createdAt    DateTime       @default(now()) @map("created_at")
  updatedAt    DateTime       @updatedAt @map("updated_at")
  Participants Participants[]

  @@map("events")
  @@schema("public")
}

model Participants {
  id         String    @id
  eventId    String    @map("event_id")
  userId     String    @map("user_id")
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")
  userDeckId String?   @map("user_deck_id")
  event      Event     @relation(fields: [eventId], references: [id])
  user       User      @relation(fields: [userId], references: [id])
  userDeck   UserDeck? @relation(fields: [userDeckId], references: [id])

  @@map("participants")
  @@schema("public")
}
